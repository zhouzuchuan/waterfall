/*
*create by zhouzuchuan (.com)
*https://github.com/zhouzuchuan/waterfall
*/
(function(h){if(h.fn.waterfall){return}var b='<style type="text/css">'+".zzc_wf_loading {position: fixed; _position: absolute; left: 50%; bottom: 200px; }"+".zzc_wf_loading p {position: absolute; top: 0; left: 0; z-index: 1000; width: 100%; height: 100%; background: #fff url(http://365jia.cn/images/load.gif) no-repeat 10px center; opacity: .8; filter: alpha(opacity=80); border-radius: 10px; }"+".zzc_wf_loading div {position: absolute; top: 0; left: 0; z-index: 1001; text-align: center; }"+".zzc_wf_loading strong {display: inline-block; color: #555; font-size: 18px; font-weight: normal; font-family: Microsoft YaHei,SimHei; padding: 0 10px; white-space: nowrap; vertical-align: middle; }"+".zzc_wf_loading em {display: inline-block; width: 32px; height: 32px; padding: 10px 0 10px 10px; vertical-align: middle; }"+".ajaxAppendBox li {visibility: hidden}"+".loadingTypeBtn {position:absolute;top:-100px;right:0px;width:10px;height:10px;background:green;z-index:-1;}"+".zzc_wf_in {animation: zzc_wf_fade 1s; -webkit-animation: zzc_wf_fade 1s; }"+"@-webkit-keyframes zzc_wf_fade {0% {opacity: 0; } 100% {opacity: 1; } }"+"@-moz-keyframes zzc_wf_fade {0% {opacity: 0; } 100% {opacity: 1; } }"+"@-o-keyframes zzc_wf_fade {0% {opacity: 0; } 100% {opacity: 1; } }"+"@-ms-keyframes zzc_wf_fade {0% {opacity: 0; } 100% {opacity: 1; } }"+"@keyframes zzc_wf_fade {0% {opacity: 0; } 100% {opacity: 1; } }";h("head").append(b);h.fn.waterfall=function(q){var r={ele:h(this),eul:h(this).find("ul"),eli:h(this).find("ul").children("li")};q=h.extend({},r,q||{});h.waterfall(q,r)};h.waterfall=function(s,v){var w=h.extend({},p,s||{});var r=h.extend({},v,{h:[],loadingType:0,loadingDom:".loadingTypeBtn",otherSpacing:0,allWidth:"",selfWidth:"",showMode:"zzc_wf_in",loadingClass:"zzc_wf_loading",ajaxPage:"",ajaxMain:"",ajaxSuffix:"",ajaxUrl:"",delta:"",flag:true,scrollH:0});var q={_init:function(){w.width=(typeof w.width==="string")?r.ele.width():w.width;r.allWidth=Math.floor((w.width-(w.length-1)*w.spacing)/w.length);r.otherSpacing=r.eli.outerWidth()-r.eli.width();r.selfWidth=r.allWidth-r.otherSpacing;var B,G,D,z=0,x=0,y=w.length,F=r.eli.length,E;r.eli.css({visibility:"hidden"});r.eul.css({position:"relative"});if((w.type==1)&&k(w.type)){E=0;y=0;C()}else{if((w.type==0)&&k(w.type)){E=B+w.spacing;A()}}function A(){r.eli.slice(0,y).each(function(H,I){h(I).addClass(r.showMode).css({position:"absolute",width:r.selfWidth,top:0,left:H*(r.allWidth+w.spacing),visibility:"visible"});q.imgLoad(h(I).find("img").get(0),function(K){z++;h(K).width((K.width>r.selfWidth)?r.selfWidth:K.width);h(K).height(h(K).height());if(!(z==(w.length>r.eli.length?r.eli.length:w.length))){return false}for(var J=0;J<w.length;J++){r.h[J]=r.eli.eq(J).outerHeight(true)}r.eul.height(Math.max.apply(null,r.h));if(w.length>=r.eli.length){setTimeout(function(){q.reposition()},500);return false}C()})})}function C(){r.eli.slice(y,F).each(function(H,I){q.imgLoad(h(I).find("img").get(0),function(J){h(J).width((J.width>r.selfWidth)?r.selfWidth:J.width);h(J).height(h(J).height());B=Math.min.apply(null,r.h);G=q.getArrayKey(r.h,B);h(J).parents("li").addClass(r.showMode).css({position:"absolute",width:r.selfWidth,top:B+w.spacing,left:G*(r.allWidth+w.spacing),visibility:"visible"});D=r.h[G]+=h(J).parents("li").outerHeight(true)+w.spacing;r.eul.height((Math.max.apply(null,r.h)>D)?Math.max.apply(null,r.h):D);x++;if((z+x)===r.eli.size()){setTimeout(function(){q.reposition();x=0},500)}})})}},getArrayKey:function(y,A){for(var x in y){if(y[x]==A){return x}}},imgLoad:function(y,z){var x=setInterval(function(){if(y.complete||(y.width&&y.height&&document.all)){z(y);clearInterval(x)}},30)},setLoading:function(){var y=document.createElement("div"),z=document.createDocumentFragment();h(y).attr("class",r.loadingClass).html("<p></p><div><em></em><strong> "+w.loadingText+" </strong></div>");z.appendChild(y);r.ele.append(z);var x=h(y).find("strong").outerWidth(true),A=h(y).find("strong").outerHeight(true),B=h(y).find("em").outerWidth(true),C=h(y).find("em").outerHeight(true);h(y).css({"width":x+B,"height":(A>C)?A:C,"margin-left":-(x+B)/2})},reposition:function(){var A=[],B,z,x;if(c(w.reposition)){for(var y=0;y<w.length;y++){A[y]=-w.spacing}r.eul.find("li").each(function(C,D){B=Math.min.apply(null,A);z=q.getArrayKey(A,B);h(D).css({position:"absolute",width:r.selfWidth,top:B+w.spacing,left:z*(r.allWidth+w.spacing)});x=A[z]+=h(D).outerHeight(true)+w.spacing});r.h=A;r.eul.height(Math.max.apply(null,A))}w.after();h(".zzc_wf_loading").stop().animate({"opacity":0,"margin-bottom":-70},1000).queue(function(C){h(this).remove();C()});h(w.loading).remove()},ajaxPosition:function(){var B,A,y,z=0;if(!r.flag){return false}r.flag=false;w.eul.append('<div class="ajaxAppendBox"></div>');var x=h(".ajaxAppendBox");if(l(w.ajax.url)){r.ajaxUrl=r.ajaxMain+r.ajaxPage+r.ajaxSuffix}h.ajax({type:w.ajax.type,url:r.ajaxUrl,timeout:1000,dataType:w.ajax.dataType,beforeSend:w.ajaxBefore(),success:function(D,C,E){if(c(w.loading)||o(w.loading)){q.setLoading()
}x.html(D);x.find("li").each(function(F,G){q.imgLoad(h(G).find("img").get(0),function(H){h(H).width((H.width>r.selfWidth)?r.selfWidth:H.width);h(H).height(h(H).height());B=Math.min.apply(null,r.h);A=q.getArrayKey(r.h,B);h(H).parents("li").addClass(r.showMode).css({position:"absolute",width:r.selfWidth,top:B+w.spacing,left:A*(r.allWidth+w.spacing),visibility:"visible"});y=r.h[A]+=h(H).parents("li").outerHeight(true)+w.spacing;r.eul.height(Math.max.apply(null,r.h));z++;if(z==x.find("li").size()){x.find("li").unwrap();q.reposition();z=0;r.ajaxPage+=1;setTimeout(function(){r.flag=true},300)}})})},error:function(C){alert(C.status+" : "+C.statusText)}})}};if(c(w.loading)||o(w.loading)){if(/^\#|^\./.test(w.loading)){loadingClass=w.loading.slice(1,w.loading.length)}q.setLoading()}if(n(w.showClass)){r.showMode=""}else{if(o(w.showClass)){if(/^\#|^\./.test(w.showClass)){r.showMode=w.showClass.slice(1,w.showClass.length)}else{r.showMode=""}}}if(l(w.ajax.url)){if(k(w.ajax.url.page)){r.ajaxPage=w.ajax.url.page}r.ajaxMain=w.ajax.url.main;r.ajaxSuffix=w.ajax.url.suffix+"?fresh="+Math.random()}else{if(o(w.ajax.url)){r.ajaxUrl=w.ajax.url}}for(var u=0;u<w.length;u++){r.h[u]=-w.spacing}if(!a(w.ajax.url)){if(w.ajax.domType=="scroll"){r.loadingType="scroll";if(!a(w.ajax.dom)){r.loadingDom=w.ajax.dom}r.ele.append('<div class="loadingTypeBtn"></div>');w.ajax.domDistance=a(w.ajax.domDistance)?0:w.ajax.domDistance;h(window).on({scroll:function(){var x=parseInt(h(document).height()-h(window).height()-w.ajax.domDistance);if((h(this).scrollTop()-x>=0)&&(h(this).scrollTop()>r.scrollH)&&s.delta<0){setTimeout(function(){q.ajaxPosition()},500);r.scrollH=h(this).scrollTop()}}})}else{if((w.ajax.domType=="click")&&!a(w.ajax.dom)){r.loadingType="click";r.loadingDom=w.ajax.dom}}h(r.loadingDom).on({click:function(){q.ajaxPosition()}})}q._init(w.type);function t(y){var x=y||event;s.delta=Math.max(-1,Math.min(1,(x.wheelDelta||-x.detail)))}m(document,t,false)};var p={type:0,width:"auto",length:6,spacing:10,loading:true,loadingText:"加载中…",showClass:false,reposition:true,after:h.noop,ajaxBefore:h.noop,ajax:{type:"GET",url:"",dataType:"",dom:"",domType:"click",domDistance:100}};function m(t,s,q){var r=(/Firefox/i.test(navigator.userAgent))?"DOMMouseScroll":"mousewheel";if(t.attachEvent){t.attachEvent("on"+r,s,q)}else{if(t.addEventListener){t.addEventListener(r,s,q)}}}function e(q){return(q===null)}function a(q){return(e(q)||typeof q=="undefined"||q===""||q==="undefined")}function g(q){return(q instanceof Array)}function i(q){return(q instanceof jQuery)}function l(q){return((q instanceof Object||typeof q=="object")&&!e(q)&&!i(q)&&!g(q)&&!f(q))}function k(q){return((q instanceof Number||typeof q=="number")&&!isNaN(q))}function o(q){return((q instanceof String||typeof q=="string")&&!a(q)&&!c(q)&&!n(q))}function f(q){return(q instanceof Function||typeof q=="function")}function j(q){return(q instanceof Boolean||typeof q=="boolean"||c(q)||n(q))}function c(q){return(q===true||q==="true")}function n(q){return(q===false||q==="false")}function d(q){return(o(q)&&q.slice(-1)=="%")}})(jQuery);